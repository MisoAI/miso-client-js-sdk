props:
# context
- key: engine_id
  type: string
  desc: |
    The engine you want to get results from. If not specified, the default engine will be used.
- key: user_id
  type: string
  desc: |
    The user who made the query and for whom Miso will personalize the results. Either `user_id` or `anonymous_id` needs to be specified.
- key: anonymous_id
  type: string
  desc: |
    The anonymous visitor who made the query and for whom Miso will personalize the results. Either `user_id` or `anonymous_id` needs to be specified for personalization to work.
- key: user_hash
  type: string
  desc: |
    The hash of `user_id` (or `anonymous_id`) encrypted by your [Secret API Key](https://api.askmiso.com/#section/Authentication/Secret%20API%20Key).
- key: miso_id
  type: string
  desc: |
    Miso-generated unique Id for each recommendation or search result.
# request options
- key: timeout
  type: integer
  desc: |
    Request timeout in milliseconds.
- key: bulk
  type: boolean
  desc: |
    Bulked API requests froms the same event loop is packed into a single HTTP request.
    Default: `false`.
# criteria
- key: q_0
  name: q
  required: true
  type: string
  desc: |
    The search query the user has entered. Must be non-empty.
- key: q_1
  name: q
  required: true
  type: string
  desc: |
    The search query the user has entered. Must be non-empty.
- key: field
  required: true
  type: string
  desc: |
    The attribute you want to make recommendations for.
- key: product_id
  type: string
  desc: |
    The `product_id` of the anchor product to recommend against.
- key: product_ids
  type: array of strings
  desc: |
    An array of `product_id` of the anchor products to recommend against.
- key: product_group_id
  type: string
  desc: |
    The `product_group_id` of the anchor product to recommend against.
- key: buy_together
  type: boolean
  desc: |
    Whether to focus on the Products that are frequently bought together.
    Default: `false`.
# product
- key: fl
  type: array of strings
  default: '[]'
  desc: |
    List of fields to retrieve. The field `product_id` is always included.
    When not specified, only `product_id` will be retrieved. 
    You can retrieve all fields with `["*"]`
- key: type
  type: string
  desc: |
    Specify the type of product to return.
# pagination
- key: start_0
  name: start
  type: integer
  desc: |
    The offset of records to retrieve.
    Default: `0`.
- key: start_1
  name: start
  type: integer
  desc: |
    The offset of records to retrieve. You can only set it when `pagination_id` is specified.
    Default: `0`.
- key: pagination_id
  type: string
  desc: |
    A unique identifier to enable pagination in Recommendation APIs. 
    To enable pagination, you generate a `pagination_id` and set it in the first and subsequent requests in the same browsing session where you want to enable pagination.
- key: rows
  type: integer
  desc: |
    Number of records to retrieve.
    Default: `5`.
- key: total
  type: integer
  desc: |
    The total number of matched records.
# response
- key: products
  type: array of objects
  desc: |
    An array of Product records. Use `fl` parameter to specify what fields are returned.
- key: spellcheck
  type: object
  desc: |
    An object of spell checking information.
- key: completion_fields
  type: array of strings
  desc: |
    Specify which fields of product are autocompleted against.
    Default: `['title']`.
- key: completions
  type: object
  desc: |
    An object of autocompletion information.
- key: attributes
  type: array of objects
  desc: |
    An array of recommended attributes.



groups:
# shared
- key: _config
  props:
  - engine_id
  - user_id
  - anonymous_id
  - user_hash
- key: _product
  props:
  - fl
  - type
- key: _page_0
  props:
  - start_0
  - rows
- key: _page_1
  props:
  - pagination_id
  - start_1
  - rows
- key: _page_2
  props:
  - start_0
  - total
# shared: event
- key: _event.product
  props:
  - event.product_ids
  - event.product_group_ids
- key: _event.context
  props:
  - user_id
  - anonymous_id
  - event.timestamp
  - miso_id
  - event.context
# request
- key: search.payload
  props:
  - _config
  - q_0
  - _product
  - _page_0
- key: autocomplete.payload
  props:
  - _config
  - q_1
  - _product
  - _page_0
- key: user_to_products.payload
  props:
  - _config
  - _product
  - _page_1
- key: user_to_attributes.payload
  props:
  - _config
  - field
  - _product
  - _page_1
- key: user_to_trending.payload
  props:
  - _config
  - _product
  - _page_1
- key: product_to_products.payload
  props:
  - _config
  - product_id
  - product_ids
  - product_group_id
  - buy_together
  - _product
  - _page_1
- key: request.options
  props:
  - timeout
  - bulk
# response
- key: search.response
  props:
  - products
  - _page_2
- key: autocomplete.response
  props:
  - completions
  - _page_2
- key: user_to_products.response
  props:
  - products
- key: user_to_trending.response
  props:
  - products
- key: user_to_attributes.response
  props:
  - attributes
- key: product_to_products.response
  props:
  - products
